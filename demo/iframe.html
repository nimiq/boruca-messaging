<!DOCTYPE html>
<html>
<head>
    <title>Boruca Messaging Demo</title>
</head>
<body>
<h1>IFrame</h1>
<script type="module">
    import Boruca from '../src/boruca.js';

        (async function () {
            const targetWindow = window.parent;
            const targetOrigin = window.location.origin;

            // Overwrite console functions to output to the top window console instead (for debugging)
            ['log', 'info', 'warn', 'error'].forEach(fn => {
                console[fn] = function() {
                    const args = Array.from(arguments);
                    args.unshift('IFRAME:');
                    window.top.console[fn].apply(window.top.console, args);
                }
            });

            class IFrame {
                decrease(number) {
                    return number - 1;
                }

                echo(message) {
                    return 'IFrame Echo: ' + message;
                }
            }

            const { proxy: TopLevelProxy } = await Boruca.proxy(targetWindow, targetOrigin, IFrame);



            console.log(await TopLevelProxy.echo("I'm sending this from the iframe!"));
            console.log(await TopLevelProxy.increase(200));
        })();
    </script>
</body>
</html>
