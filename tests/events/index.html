<!DOCTYPE html>
<html>
<head>
    <title>Boruca Messaging Demo</title>
    <link rel="stylesheet" href="../test.css">
    <script src="../test.js"></script>
</head>
<body>
    <h1>RPC Event Tests</h1>
    <iframe src="./iframe.html"></iframe>

    <script type="module">
        import { EventClient } from '../../src/boruca.js';

        (async function () {
            const targetWindow = document.querySelector('iframe').contentWindow;

            const eventClient = await EventClient.create(targetWindow);

            let result;

            const offTester = setTimeout(() => testResult('Can remove listener', true, true), 600);

            function test1(value) {
                if (value === 2) testResult('Can receive fired event', value, 2);
                if (value === 8) {
                    clearTimeout(offTester);
                    testResult('Can remove listener', false, true);
                }
                eventClient.off('test1', boundTest1);
            }

            function test2(value) {
                testResult('Can receive fired event', value, 5);
            }

            const boundTest1 = test1.bind(self);
            const boundTest2 = test2.bind(self);

            eventClient.on('test1', boundTest1);
            eventClient.on('test2', boundTest2);
        })();
    </script>
</body>
</html>
