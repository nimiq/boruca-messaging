<!DOCTYPE html>
<html>
<head>
    <title>Boruca Messaging Demo</title>
</head>
<body>
<h1>Top Frame</h1>
<iframe src="./iframe.html"></iframe>

<script type="module">
    import { EventClient } from '../src/boruca.js';

        (async function () {
            const $iframe = document.querySelector('iframe');
            const targetWindow = $iframe.contentWindow;

            const eventClient = await EventClient.create(targetWindow);

            function test(value) {
                console.log(`test received: ${value}`);
            }

            function doubleTest(value) {
                console.log(`double test: ${value}`);
            }

            const boundDoubleTest = doubleTest.bind(self);
            const boundTest = test.bind(self);

            eventClient.on('test', boundTest) ;
            eventClient.on('test', boundDoubleTest) ;
            eventClient.on('water', v => console.log('water ' + v));

            setTimeout(() => eventClient.off('test', boundDoubleTest), 2500);
            setTimeout(() => eventClient.off('test', boundTest), 7000);
        })();
    </script>
</body>
</html>
