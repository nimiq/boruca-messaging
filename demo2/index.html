<!DOCTYPE html>
<html>
<head>
    <title>Boruca Messaging Demo</title>
</head>
<body>
<h1>Top Frame</h1>
<iframe src="./iframe.html"></iframe>

<script type="module">
    import Boruca from '../src/boruca.js';
    import EventListener from '../src/event-listener.js';

    (async function () {
        const $iframe = document.querySelector('iframe');
        const targetWindow = $iframe.contentWindow;
        const targetOrigin = window.location.origin;

        const eventListener = new EventListener();

        const { proxy: nanoProxy, stub: thisSide } = await Boruca.proxy(targetWindow, targetOrigin, eventListener.Receiver);

        eventListener.on('test', (value) => alert(`test received: ${value}`));

        alert(await nanoProxy.getBalance());
        alert(await nanoProxy.findFunction());
    })();
</script>
</body>
</html>
