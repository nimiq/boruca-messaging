<!DOCTYPE html>
<html>
<head>
    <title>Boruca Messaging Demo</title>
    <script src="../src/boruca.js"></script>
    <script src="../src/IObservable.js"></script>
</head>
<body>
<h1>IFrame</h1>
<script>
    (async function () {
        const targetWindow = window.parent;
        const targetOrigin = window.location.origin;

        // Overwrite console functions to output to the top window console instead (for debugging)
        ['log', 'info', 'warn', 'error'].forEach(fn => {
            console[fn] = function() {
                const args = Array.from(arguments);
                args.unshift('IFRAME:');
                window.top.console[fn].apply(window.top.console, args);
            }
        });

        const proxies = new Set();

        const { proxy: topLevelProxy } = await Boruca.proxy(targetWindow, targetOrigin);

        proxies.add(topLevelProxy);

        function onValueChanged() {
            // check which proxy is registered for event
            for (const proxy of proxies) {
                proxy.fire('test');
            }
        }

        onValueChanged();

    })();
</script>

</body>
</html>
